<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Hacktoberday 2020: Aprendizaje-como-c√≥digo</title>

    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/extra.css">
    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/qa-uni.css">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/monokai.css">

    <!-- Printing and PDF exports -->
    <script>
     var link = document.createElement( 'link' );
     link.rel = 'stylesheet';
     link.type = 'text/css';
     link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
     document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
	<section data-background='https://live.staticflickr.com/65535/50471435996_83a5174bc3_k_d.jpg'>
          <h1>Aprendizaje-como-c√≥digo</h1>
          <h2>usando herramientas CI/CD para evaluaci√≥n autom√°tica de proyectos en inform√°tica</h2>
          <h3><code>@jjmerelo | github.com/JJ</code></h3>
          <h2>Im√°genes y texto <code>cc-by-sa</code></h2>
        </section>

        <section
          data-background='https://live.staticflickr.com/65535/50517344412_701823b0ce_k_d.jpg'>
          <h2>37 a√±os programando</h2>
          <h1 class='fragment'>33 en la UGR</h1>
          <h2 class='fragment'>12 en GitHub</h2>
        </section>

        <section
          data-background='https://live.staticflickr.com/65535/50517349887_b1e58f2fba_k_d.jpg'>
          <h1>üíò Raku</h1>
        </section>

        <section><h1>DevOps es</h1>
          <h1 class='fragment'><strong>Infraestructura</strong> como c√≥digo</h1>
          <h1 class='fragment'><strong>Configuraci√≥n</strong> como
            c√≥digo</h1>
          <h1 class='fragment'><strong>Tests</strong> como c√≥digo</h1>
          <aside class='notes'>Automatizaci√≥n y repetibilidad son lo
          m√°s importante. Pero tambi√©n escalabilidad y poder hacer las
            cosas r√°pidamente con degradaci√≥n escasa de las prestaciones.</aside>
        </section>

        <section><h1>Aprendizaje-como-c√≥digo es</h1>
          <h1 class='fragment'>Codificar objetivos de aprendizaje como
            tests</h1>
        </section>

        <section><h1>¬øPor qu√©?</h1></section>

        <section
        data-background='https://live.staticflickr.com/4096/4919142987_f4f1eda66e_k_d.jpg'><h1>‚ë†
          Se aprende haciendo</h1>
          <aside class='notes'>La ingenier√≠a inform√°tica es algo
        esencialmente pr√°ctico. Hay que hacer cosas, resolver
            problemas con ordenadores. Y la mejor forma de aprenderlo
            es hacerlo.</aside>
        </section>

        <section data-background='https://live.staticflickr.com/1912/43077933160_a6b5c071b2_k_d.jpg'>
          <h1>‚ë° Aprender es un proceso de mejora continua</h1>
          <aside class='notes'>No para el aprendizaje en el momento
          que se eval√∫a. La evaluaci√≥n debe ser un punto de control
            para dar la oportunidad de aprender lo evaluado.</aside>

        </section>

        <section data-background='https://live.staticflickr.com/10/12756540_ff7a2a9fe1_o_d.jpg'><h1>‚ë¢ La capacidad de corregir no puede limitar.</h1>
          <aside class='notes'>Si s√≥lo puedes ense√±ar (y la gente
          aprender) lo que se puede corregir "a mano", se frena la
          capacidad de exploraci√≥n y de toma de decisiones del
          estudiante, se mata la creatividad, y finalmente se acaba
            cayendo en contenidos repetitivos y obsoletos. Y el l√≠mite
          est√° tanto en lo cualitativo (limitarse a lo que a uno
          conoce) como cuantitativo (a los aspectos que uno pueda leer
          exclusivamente).
          </aside>
          </section>


          <section>
          <section data-background='https://live.staticflickr.com/65535/48498258487_86071d3485_o_d.jpg'>
          <h1>Curso 2015-16 üìÖ Asignatura <em>infraestructura
          virtual</em> ‚âÖ <em>cloud computing</em></h1>
          <aside class='notes'>Me decid√≠ por "liberar" la clase, y dar
          libertad al estudiante para llegar a los objetivos de la
            asignatura por donde quisiera.</aside>
          </section>

          <section
            data-background='https://live.staticflickr.com/4306/35774761502_356b775fe4_k_d.jpg'><h1>Cambiemos
            la forma de hacer las cosas</h1>
          </section>

          <section
            data-background='https://live.staticflickr.com/919/42530410115_3b8942e218_k_d.jpg'>
            <h1>OK, ¬øc√≥mo se hace eso?</h1>
          </section>
          
          </section>


          <section>
            <section data-background='https://live.staticflickr.com/5136/5489474407_8686dbf7d0_k_d.jpg'><h1>Ense√±anza basada en proyecto</h1>
              <h1 class='fragment'>Clase <em>invertida</em></h1>
            </section>
            
          <section data-background='https://live.staticflickr.com/6212/6260959931_3e5d017949_3k_d.jpg'><h1>¬øD√≥nde se hace?</h1>
            <h1 class='fragment'>En GitHub, claro</h1>
          <h2 class='fragment'>GitHub es la red social de la gente que programa</h2>
          <aside class='notes'>Y, por supuesto, hacerlo en GitHub. El hecho de usar GitHub para las
          entregas ya, de por s√≠, tiene ciertas ventajas: notificaci√≥n
            de las entregas, comentarios sobre la misma... Los PRs los
          usamos desde 2015, y <a
            href='https://github.com/JJ/IV16-17/pull/362'>aqu√≠</a>, por
          ejemplo, el a√±o siguiente se ve c√≥mo se usan reviews, por
          ejemplo. Sin embargo, 0 tests</aside>
          </section>

          <section><h1>¬°Es software <strong>libre</strong>!</h1>
            <h2 class='fragment'>+ buenas pr√°cticas: revisi√≥n de
              c√≥digo, b√∫squeda f√°cil de copieteo, y el propio uso de
              git.</h2>
            <aside class='notes'>Es un win win... Pero todav√≠a hay que
              enfrentarse a un repositorio con un mont√≥n de ficheros,
            leer un mont√≥n de documentos, comprobar un mont√≥n de
              c√≥digo... Al final, se est√° usando en la pr√°ctica lo
              que se se va a usar realmente. Se aprende haciendo. Si
              usas git, est√°s aprendiendo a usar git de forma habitual.</aside>
          </section>

          <section><h2>Pero...</h2>
            <h1 class='fragment'>La correcci√≥n era manual</h1>
            <img class='fragment' src='img/correccion.png'
                 alt='Corrigiendo hito 0'>
            <aside class='notes'>Funciona si no tienes que hacerlo t√∫, claro</aside>
          </section>

          <section
          data-background='https://live.staticflickr.com/4886/45162921155_f29aaf052e_k_d.jpg'><h1>Lo
            que est√° hecho, est√° hecho</h1>
            <aside class='notes'>Y ya no hay vuelta atr√°s. Aunque se
          permite reenviar, el error ya est√° hecho y cambios
          adicionales requieren trabajo adicional por parte del
              profesor... Mal escalado. Es como la comida. Cuando est√°
          hecha, s√≥lo puedes com√©rtela o tirarla. </aside>
          </section>

        </section>

        <section>
          <section><h1>2017 üìÖ Tiempo de cambios</h1>
            <img
          src='https://live.staticflickr.com/8069/8225831501_626007ceea_o_d.jpg'
          alt='se acab√≥ la OSL'>
            <aside class='notes'>De repente, mucho m√°s tiempo en
          mis manos pero tambi√©n hab√≠a un problema de escala: hacer
          manualmente lo que hac√≠a el profesor de pr√°cticas era
              pr√°cticamente imposible.</aside>
          </section>

          </section>

          <section>
            <section><h2>Toda la informaci√≥n necesaria para testear un
          proyecto est√° en</h2>
          <h1 class='fragment'>El cuerpo del <em>pull request</em></h1>
          <h1 class='fragment'>El <code>README.md</code></h1>
          <h1 class='fragment'>GitHub</h1>
          <h1 class='fragment'>Alg√∫n fichero adicional de
            configuraci√≥n</h1>
            </section>

          <section><h1>Si GitHub lo sabe</h1>
            <h1 class='fragment'>Que GitHub lo testee</h1>
          </section>

          <section><h1>Analiza el PR: Perl FTW</h1>
            <pre><code>my $repo = Git->repository ( Directory =&gt; '.' );
my $diff = $repo-&gt;command('diff','HEAD^1','HEAD');
my $diff_regex = qr/a\/proyectos\/hito-(\d)\.md/;
my $github;

SKIP: {
  my ($this_hito) = ($diff =~ $diff_regex);
  skip "No hay env√≠o de proyecto", 5 unless defined $this_hito;  my @files = split(/diff --git/,$diff);
  my ($diff_hito) = grep( /$diff_regex/, @files);
  say "Tratando diff\n\t$diff_hito";
  my @lines = split("\n",$diff_hito);
  my @adds = grep(/^\+[^+]/,@lines);
  is( $#adds, 0, "A√±ade s√≥lo una l√≠nea");
  my $url_repo;
  if ( $adds[0] =~ /\(http/ ) {
    ($url_repo) = ($adds[0] =~ /\((http\S+)\)/);
  } else {
    ($url_repo) = ($adds[0] =~ /^\+.+(http\S+)/s);
  }</code></pre>
          </section>
          
          <section><h1><em>Scraping FTW</em></h1>
            <pre><code>sub closed_issues {
  my ($user,$repo) = @_;
  my $page = get( "https://github.com/$user/$repo".'/issues?q=is%3Aissue+is%3Aclosed' );
  my (@closed_issues ) = ( $page =~ m{&lt;li\s+(id=.+?</li>)}gs );
  return @closed_issues;
}

sub closes_from_commit {
  my ($user,$repo,$issue) = @_;
  my $page = get( "https://github.com/$user/$repo/issues/$issue" );
  return $page =~ /closed\s+this\s+in/gs ;

}</code></pre>
          </section>

          <section><h1>Aderezado con Travis.</h1>
            <pre><code>branches:
  except:
    - gh-pages
language: perl
perl:
  - "5.16"
before_install:
install: cpanm Test::More Test::Harness Git File::Slurper JSON Net::Ping TAP::Formatter::Color Term::ANSIColor
script: prove -c</code></pre>
        </section>

        <section><h1>Prueba hasta que funcione.</h1>
          <img src='img/travis.png' alt='imagen de travis'.>
        </section>
        <section><h1>Cambio fundamental: aprende mientras env√≠as</h1>
          <aside class='notes'>Lo que est√° muerto, s√≠ se puede matar</aside>
        </section>


        <section><h2>Cambio m√°s fundamental:</h2>
          <h1 class='fragment'>Aprendizaje como c√≥digo</h1>
          <pre><code>    doing("hito 5");
    my ($deployment_url) = ($README =~ /Despliegue final:\s+(\S+)\b/);
    if ( $deployment_url ) {
      diag "‚òë Detectada IP de despliegue $deployment_url";
    } else {
      diag "‚úó Problemas detectando IP de despliegue";
    }
    unlike( $deployment_url, qr/(heroku|now)/, "Despliegue efectivamente hecho en IaaS" );
    isnt( $deployment_url, "", "URL de despliegue hito 5");
    check_ip($deployment_url);
    my $status = get "http://$deployment_url/status";
    isnt( $status, undef, "Despliegue correcto en $deployment_url/status" );
    my $status_ref = from_json( $status );
    like ( $status_ref->{'status'}, qr/[Oo][Kk]/, "Status de $deployment_url correcto");
          </code></pre>
          <aside class='fragment'>Los tests son las especificaciones
            de lo que hay que aprender.</aside>
        </section>
          </section>

          <section>
            <section
            data-background='https://live.staticflickr.com/4713/40422768482_aea711c619_k_d.jpg'><h1>2019
            üìÖ El escrapear se va a acabar</h1>
              <h1 class='fragment'>üö´ usar secretos en PRs</h1>
              <aside class='notes'>GitHub impidi√≥ escrapear desde
                Travis. Se acab√≥ lo que se daba. Tampoco se puede usar
            el API de GitHub con tu API key porque no se pueden usar
            "secrets" en PRs. Ni siquiera si es de s√≥lo lectura. Y no
            te puedes arriesgar a usarlo sin API key porque no sabes
            cuantas PRs vas a recibir en un rato.</aside>
            </section>

            <section><h1>Presentando <em>GitHub Actions</em></h1>
              <pre><code>name: "Comprueba hitos y milestones"
on:
  pull_request:
    paths:
      - 'proyectos/hito-[1234567].md'
      - '!objetivos/*.(md|org)'

jobs:
  obtain-repo:
    runs-on: ubuntu-latest
    steps:
      - name: Extrae URL del repositorio
        uses: JJ/github-pr-contains-action@releases/v1
        with:
          github-token: ${{github.token}}
          filesChanged: 1
      - name: Comprueba hitos e issues
        uses: JJ/repo-in-diff-gh-action@releases/v0
        with:
          github-token: ${{github.token}}
          minMilestones: 3</code></pre>
              <aside class='notes'>En la primera parte miramos al
  diff; en la segunda es donde efectivamente comprobamos los
                milestones y dem√°s.</aside>
            </section>

            <section><h1><a
            href='https://github.com/JJ/repo-in-diff-gh-action'>Usando</a>
              el API de GitHub</h1>
              <pre><code> const milestones = await github.issues.listMilestonesForRepo( { owner: user, repo: repo } )
		    if ( ! milestones.data.length ) {
			core.setFailed("‚ùå There should be at least one milestone")
		    }
		    const minMilestones = +core.getInput('minMilestones')
		    if ( minMilestones && milestones.data.length < minMilestones ) {
			core.setFailed( "‚ùå There should be more than " + minMilestones + " milestone(s)");
		    }
		    var totalIssues = 0
		    var totalClosedIssues = 0
		    milestones.data.forEach( async function( milestone ) {
			totalIssues += milestone.open_issues + milestone.closed_issues
			totalClosedIssues += milestone.closed_issues
		    })
		    console.log( "‚úÖ There are " + totalIssues + "
            issues in your milestones  and " + totalClosedIssues + "
            closed issues ")</code></pre>

              <aside class='notes'>Escritos en typescript, tienes
              acceso a una serie de argumentos, pero lo m√°s importante
              es que puedes acceder f√°cilmente al API. Cuando empec√©
              con esto estaban en beta limitada, y la forma de
              documentarse era a base de mirar los fuentes de las
                actions y buscar en GitHub.</aside>
            </section>

            <section><h1><a href='https://github.com/JJ/IV-19-20/pull/895'>Comprobando</a> lo comprobable</h1>
              <img src='img/checks-19-20.png' alt='Usando GH actions +
                   Travis'>
            </section>

            <section><h1>Acelerando los tests ‚Üí mejor aprendizaje</h1>
               <img src='img/pr-speed.png' alt='Velocidad de los
                    tests'>
               <aside class='notes'>No s√≥lo era m√°s r√°pido, la
               duraci√≥n era m√°s consistente. En travis es dif√≠cil que
               algo tarde menos de 15 segundos, pero se llegaba a una
                 velocidad bastante buena.</aside>
            </section>

            <section><h1>Docker FTW</h1>
              <pre><code>FROM perl:5.32-slim-threaded
LABEL version="1.5" maintainer="JJ Merelo <jjmerelo@GMail.com>" perl5version="5.28"

# Set up dir and download modules
RUN chmod o+r /etc/resolv.conf
RUN mkdir /test && apt-get update \
    && apt-get install -y git curl libio-socket-ssl-perl libnet-ssleay-perl gcc  \
    && cpanm Test::More Test::Harness Git File::Slurper JSON TAP::Formatter::Color Term::ANSIColor Mojo::UserAgent Net::Ping YAML
RUN perl --version
VOLUME /test
WORKDIR /test

ENTRYPOINT prove -I/usr/lib -c</jjmerelo></code></pre>
                <aside class='notes'>El tener todos los m√≥dulos
                instalados es un ahorro de los aproximadamente dos
                minutos y medio que se tarda. No es una gran cosa en
                un sistema de producci√≥n, pero en los estudiantes es
                la diferencia entre enviar y largarse y enviar y
                  esperar a ver qu√© pasa ‚Üí mejora en el aprendizaje.</aside>
            </section>

            <section><h1>2020 üìÖ  <code>github script</code> + API v4 (GraphQL)</h1>
              <pre><code>const query = `query($owner:String!, $name:String!, $issue:Int!) {
                            repository(name: $name , owner: $owner  ) {
                              issue(number: $issue) {
                                timelineItems(itemTypes: CLOSED_EVENT, last: 1) {
                                  nodes {
                                    ... on ClosedEvent {
                                      closer {
                                        __typename
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }`;</code></pre>
            </section>

            <section><h1>Los estudiantes son tus clientes.</h1>
              <img src='img/issue-abierto.png' alt='Contestando un
                   issue'>
              <aside class='notes'>En este caso, tambi√©n tus
              hijas... En todo caso, el resultado final no es el de
              este issue, sino de otros dos que ten√≠an diferentes
              casu√≠sticas. Finalmente, la soluci√≥n con GraphQL fue la
                m√°s adecuada (y consecuencia de la ayuda de alguien en
                Stackoverflow).</aside>
            </section>

            <section><h1>Si GitHub lo sabe...</h1>
              <img src='img/checks-20-21.png' alt='pop-up de
              comprobaciones'>
              <aside class='notes'>Se rompe el l√≠mite de s√≥lo poder
              corregir lo que uno puede f√≠sicamente hacer. Cosas que
              son imposibles, como comprobar que todos los issues se
              han cerrado con un commit (o PR), ahora se pueden hacer
              f√°cilmente. Y a escala: m√°s estudiantes no te quitan
              tiempo, y te dejan centrarte en aconsejar al estudiante
              mejoras en su c√≥digo o en la forma de presentarlo.</section>
          </section>

          <section>
            <section data-background='https://live.staticflickr.com/1438/1240116506_f4ab6cfe40_k_d.jpg'><h1>¬øFunciona?</h1>
              <h1 class='fragment'>Pregunta incorrecta.</h1>
              <aside class='notes'>Aunque de hecho, en general
            funciona y permite examinar lo que entrega un estudiante a
            un nivel que es imposible si no usas herramientas
            autom√°ticas, y con un escalado buen√≠simo hasta un n√∫mero
            considerable de estudiantes. Al coste de bastantes horas
                programando, claro.</aside>
            </section>

            <section><h1>¬øEs estudiante aprende m√°s y mejor?</h1>
              <h1 class='fragment'>Discutiblemente,
              <strong>s√≠</strong></h1>
            </section>

            <section data-background='https://live.staticflickr.com/6077/6082439509_6bcb5d3804_3k_d.jpg'><h2>Objetivos de aprendizaje de estudiante y
              profesores coinciden</h2>
              <h1 class='fragment'>Que es de lo que se trata</h1>
            </section>
          </section>


          <section data-background='https://live.staticflickr.com/65535/50327948996_f2a87c2d28_k_d.jpg'><h1>Muchas gracias.</h1></section>

      </div>
    </div>

    <script src="js/reveal.js"></script>

    <script>
     // More info about config & dependencies:
     // - https://github.com/hakimel/reveal.js#configuration
     // - https://github.com/hakimel/reveal.js#dependencies
     Reveal.initialize({
       width: '95%',
       height: '95%',
       controls: true,
       progress: true,
       history: true,
       autoPlayMedia: true,
       dependencies: [
	 { src: 'plugin/notes/notes.js', async: true },
	 { src: 'plugin/highlight/highlight.js', async: true },
         { src: 'plugin/reveal-code-focus/reveal-code-focus.js',
           async: true,
           callback: function() {
             RevealCodeFocus();
           }
         }
       ]
     });
    </script>
  </body>
</html>
